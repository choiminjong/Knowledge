# 그래프 구축 가이드

수집한 뉴스 기사 데이터를 Neo4j 그래프 데이터베이스에 적재합니다.

## 개요

`notebooks/02_GraphBuilder.ipynb`는 Excel 데이터를 Recursive Chunking으로 분할하여 Neo4j에 그래프 형태로 구축합니다.

## 그래프 스키마

```
(Media)─[:PUBLISHED]─>(Article)─[:HAS_CHUNK]─>(Content)
                          │
                     [:BELONGS_TO]
                          │
                      (Category)

(Author)─[:WROTE]─>(Article)
```

### 노드 타입

| 노드 | 속성 | 설명 |
|------|------|------|
| Article | article_id, title, url, published_date | 뉴스 기사 |
| Content | content_id, chunk | 기사 본문 청크 (임베딩 대상) |
| Category | name | 카테고리 (정치, 경제 등) |
| Media | name | 언론사 |
| Author | name | 기자 |

### 관계 타입

| 관계 | 설명 |
|------|------|
| HAS_CHUNK | Article → Content (기사가 청크를 포함) |
| BELONGS_TO | Article → Category (기사가 카테고리에 속함) |
| PUBLISHED | Media → Article (언론사가 기사를 발행) |
| WROTE | Author → Article (기자가 기사를 작성) |

## Recursive Chunking

기사 본문을 의미 단위로 분할합니다. 구분자 우선순위:

1. `\n\n` (문단 구분)
2. `\n` (줄바꿈)
3. `. ` (문장 끝)
4. `。` (한국어 마침표)
5. `, ` (쉼표)
6. ` ` (공백)

설정:
- `chunk_size = 500` (최대 500자)
- `overlap = 100` (청크 간 100자 중복)

## 실행 방법

1. STEP 1(DataScrapping)으로 생성된 `Articles_*.xlsx` 파일이 프로젝트 루트에 있어야 합니다.

2. Neo4j가 실행 중이고 `.env`에 접속 정보가 설정되어야 합니다.

3. `notebooks/02_GraphBuilder.ipynb`를 순서대로 실행합니다.

## 노트북 실행 순서

| 셀 | 설명 |
|-----|------|
| 1. 데이터 로드 | 최신 `Articles_*.xlsx` 자동 탐색 |
| 2. Neo4j 연결 | `.env` 기반 드라이버 초기화 |
| 3. DB 초기화 | 기존 노드/관계 삭제, 제약조건 생성 |
| 4. 청킹 함수 | `recursive_chunk_text()` 정의 |
| 5. 그래프 빌드 | 노드/관계 생성 (Article, Content, Media, Category, Author) |
| 6. 검증 | 노드 수, 관계 수 확인 |

## Neo4j 데이터 확인 (Cypher 쿼리)

그래프가 올바르게 구축되었는지 확인하는 쿼리들:

```cypher
-- 전체 노드/관계 수
MATCH (n) RETURN labels(n)[0] AS label, count(n) AS count

-- 카테고리별 기사 수
MATCH (a:Article)-[:BELONGS_TO]->(c:Category)
RETURN c.name AS category, count(a) AS articles
ORDER BY articles DESC

-- 관계 패턴 확인
MATCH (n)-[r]->(m)
RETURN labels(n)[0] AS source, type(r) AS rel, labels(m)[0] AS target, count(*) AS cnt

-- 특정 기사의 청크 확인
MATCH (a:Article {title: "기사제목"})-[:HAS_CHUNK]->(c:Content)
RETURN c.content_id, substring(c.chunk, 0, 100) AS preview
```

## 다음 단계

그래프 구축이 완료되면 [검색 시스템 가이드](04_검색시스템.md)로 진행하세요.
